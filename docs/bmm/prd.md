# Cometix - Product Requirements Document

**Author:** m1397
**Date:** 2024-11-28
**Version:** 1.0

---

## Executive Summary

Cometix 是一款**移动端优先的隐私优先 AI 助手**，基于 Flutter 构建，深度集成 Google Gemini API。在 LLM 客户端市场中，桌面端竞争激烈（Cherry Studio、TypingMind），但移动端原生体验严重不足。Cometix 填补这一市场空白，为移动用户提供流畅、安全、功能强大的 AI 对话体验。

**核心价值主张：**
- 移动端最佳体验（Flutter 原生性能）
- 隐私优先（本地存储、可选云同步）
- 多模态交互（文本 + 语音 + 图像）
- 现代化设计（shadcn_flutter 组件系统）

### What Makes This Special

**核心差异化：移动端 + 隐私 + 性能的三角优势**

1. **移动端极致体验** - 竞品要么无移动端（Cherry Studio），要么移动端体验差（Monica）。Cometix 用 Flutter 原生性能 + Zoom Drawer 动画 + 手势操作，打造移动端最佳 AI 客户端。

2. **隐私优先设计** - 竞品多云端存储，用户数据不可控。Cometix 默认本地存储，用户完全掌控数据，可选端到端加密云同步。

3. **轻量高性能** - Electron 应用 200MB+，启动慢。Cometix 安装包 <50MB，启动 <2秒，内存 <100MB。

---

## User Journeys

### Journey 1: 小明 - 通勤路上的代码问答

小明是一名 26 岁的前端开发者，每天通勤 1 小时。他想利用碎片时间学习新技术、解决代码问题，但现有 AI 工具要么没有移动端，要么体验差。

- 打开 Cometix（<2秒启动）→ 语音输入问题 → AI 流式回答 → 代码高亮显示 → 一键复制代码 → 收藏到本地

**关键需求：** 快速启动、语音输入、代码高亮、离线查看历史

---

### Journey 2: 小红 - 学生的学习助手

小红是一名大三学生，需要 AI 帮助理解复杂概念、翻译论文、准备考试。她担心隐私泄露，不想把学习内容上传到云端。

- 拍照上传题目 → AI 识别并解答 → Markdown 格式化显示 → 保存到本地笔记 → 导出为 PDF 分享

**关键需求：** 图片识别、Markdown 渲染、本地存储、导出功能

---

### Journey 3: 老王 - 商务人士的邮件助手

老王是一名 40 岁的销售经理，经常需要用英文写邮件。他希望有一个私密的 AI 助手帮他润色邮件，但不想让公司敏感信息上传到第三方服务器。

- 复制邮件内容 → 粘贴到 Cometix → 选择"邮件润色"快捷短语 → AI 优化 → 复制结果 → 粘贴回邮件

**关键需求：** 快捷短语、隐私保护、快速复制粘贴

---

### Journey 4: 管理员 - 自定义助手配置

高级用户想创建专属 AI 助手角色，设置特定的系统提示词，用于特定场景（如代码审查、写作风格）。

- 进入设置 → 创建新助手 → 设置名称和系统提示词 → 选择默认模型 → 保存 → 在聊天中切换助手

**关键需求：** 自定义助手、系统提示词、模型切换

---

## Project Classification

**Technical Type:** mobile_app
**Domain:** general (AI/LLM 客户端)
**Complexity:** medium

本项目是一个跨平台移动应用，使用 Flutter 框架开发，主要面向 Android 和 iOS 平台，同时支持 Web。核心技术挑战在于：
- 流式 AI 响应的流畅渲染
- 本地数据持久化和加密
- 多模态输入（语音、图像）集成
- 跨平台一致的用户体验

---

## Success Criteria

### 用户成功指标

| 指标 | 目标 | 衡量方式 |
|------|------|----------|
| **启动体验** | <2秒启动 | 冷启动时间测量 |
| **对话流畅度** | 流式响应无卡顿 | 用户反馈 + 性能监控 |
| **隐私信任** | 用户理解数据本地存储 | 用户调研 |
| **功能满足** | 完成核心任务（问答、代码、翻译） | 任务完成率 |

### 业务成功指标

| 指标 | 3个月目标 | 12个月目标 |
|------|-----------|------------|
| **日活用户 (DAU)** | 1,000 | 10,000 |
| **7日留存率** | >30% | >40% |
| **NPS 评分** | >40 | >50 |
| **付费转化率** | - | >5% |

---

## Product Scope

### MVP - Minimum Viable Product

**核心功能（必须有）：**

1. **基础对话**
   - 多模型支持（Gemini 优先，可扩展 GPT/Claude）
   - 流式响应显示
   - Markdown 渲染（代码高亮、表格、列表）
   - 对话历史管理

2. **本地存储**
   - 对话历史本地持久化
   - 设置和偏好本地存储
   - 无需登录即可使用

3. **输入增强**
   - 快捷短语系统
   - 图片上传（多模态）
   - 手势操作（左滑删除、长按复制）

4. **UI/UX**
   - Zoom Drawer 侧边栏
   - 深色/浅色模式
   - shadcn_flutter 组件系统

5. **导出功能**
   - 对话导出为 Markdown
   - 一键复制消息

### Growth Features (Post-MVP)

**差异化功能（应该有）：**

1. **语音交互**
   - 语音输入（Speech-to-Text）
   - 语音播放回答（Text-to-Speech）
   - 实时语音对话（类 GPT-4o Voice）

2. **多模型能力**
   - 多模型切换 UI
   - 多模型对比回答（同一问题发给多个模型）
   - 智能模型推荐

3. **安全增强**
   - 生物识别锁（Face ID / 指纹）
   - 隐私模式（临时对话不保存）
   - 端到端加密云同步

4. **效率工具**
   - 小组件（桌面快速提问）
   - 智能摘要（长对话自动总结）
   - 对话模板市场

5. **社交功能**
   - 对话分享（生成图片/链接）
   - 助手市场（下载社区助手）

### Vision (Future)

**长期愿景功能：**

1. **本地模型**
   - 集成 Gemini Nano（Android）
   - 支持 Ollama 本地模型
   - 离线使用能力

2. **Agent 能力**
   - MCP 协议支持
   - 工具调用（搜索、计算、API）
   - 自动化工作流

3. **生态建设**
   - 插件系统
   - 开发者 API
   - 企业版（团队协作）

---

## Mobile App Specific Requirements

### 平台支持

| 平台 | 优先级 | 状态 |
|------|--------|------|
| Android | P0 | 开发中 |
| iOS | P0 | 开发中 |
| Web | P1 | 实验性 |

### 设备能力

| 能力 | 用途 | 优先级 |
|------|------|--------|
| 摄像头 | 图片上传、拍照识别 | P0 |
| 麦克风 | 语音输入 | P1 |
| 生物识别 | 应用锁 | P1 |
| 剪贴板 | 快速粘贴 | P0 |
| 通知 | 提醒功能 | P2 |
| 小组件 | 快速入口 | P1 |

### 性能要求

| 指标 | 目标值 |
|------|--------|
| 冷启动时间 | <2秒 |
| 内存占用 | <100MB |
| 安装包大小 | <50MB |
| 流式响应延迟 | <100ms |
| 动画帧率 | 60fps |

---

## User Experience Principles

### 设计原则

1. **移动优先** - 所有交互针对触屏优化，单手可操作
2. **隐私可见** - 用户随时知道数据存储位置
3. **渐进式复杂度** - 新手简单上手，高级用户可深度定制
4. **情感化设计** - AI 头像动画、打字机效果增强交互感

### Key Interactions

| 交互 | 描述 | 优先级 |
|------|------|--------|
| **Zoom Drawer** | 侧边栏缩放滑动动画 | ✅ 已实现 |
| **流式打字机** | AI 回答逐字显示 + 光标闪烁 | P0 |
| **手势操作** | 左滑删除、右滑收藏、长按复制 | P0 |
| **快捷短语** | 输入框上方快速选择 | ✅ 已实现 |
| **模型切换** | 顶部下拉快速切换 | P1 |

---

## Functional Requirements

### 用户账户与数据

- FR1: 用户可以无需登录直接使用应用
- FR2: 用户可以选择启用云同步（可选）
- FR3: 用户可以导出所有本地数据
- FR4: 用户可以一键删除所有数据
- FR5: 用户可以设置生物识别锁保护应用

### 对话管理

- FR6: 用户可以创建新对话
- FR7: 用户可以查看对话历史列表
- FR8: 用户可以搜索历史对话
- FR9: 用户可以删除单条对话
- FR10: 用户可以批量删除对话
- FR11: 用户可以为对话添加标题
- FR12: 用户可以收藏重要对话

### AI 交互

- FR13: 用户可以发送文本消息给 AI
- FR14: 用户可以上传图片让 AI 分析
- FR15: 用户可以使用语音输入消息
- FR16: 用户可以中断 AI 正在生成的回答
- FR17: 用户可以重新生成 AI 回答
- FR18: 用户可以编辑已发送的消息并重新提问
- FR19: 系统以流式方式显示 AI 回答
- FR20: 系统正确渲染 Markdown 格式（代码、表格、列表）

### 模型管理

- FR21: 用户可以配置自己的 API Key
- FR22: 用户可以切换不同的 AI 模型
- FR23: 用户可以查看当前使用的模型信息
- FR24: 系统支持多个 LLM 提供商（Gemini、OpenAI、Claude）

### 助手系统

- FR25: 用户可以创建自定义助手
- FR26: 用户可以为助手设置系统提示词
- FR27: 用户可以为助手选择默认模型
- FR28: 用户可以在对话中切换助手
- FR29: 用户可以编辑和删除自定义助手

### 快捷短语

- FR30: 用户可以创建快捷短语
- FR31: 用户可以编辑和删除快捷短语
- FR32: 用户可以通过快捷键触发短语
- FR33: 用户可以对快捷短语分类管理

### 输出与分享

- FR34: 用户可以复制单条消息
- FR35: 用户可以复制代码块
- FR36: 用户可以导出对话为 Markdown
- FR37: 用户可以分享对话（生成图片或链接）

### 设置与个性化

- FR38: 用户可以切换深色/浅色主题
- FR39: 用户可以调整字体大小
- FR40: 用户可以自定义消息气泡样式
- FR41: 用户可以设置默认模型
- FR42: 用户可以管理存储空间

---

## Non-Functional Requirements

### Performance

| 指标 | 要求 | 原因 |
|------|------|------|
| 冷启动时间 | <2秒 | 移动端用户期望即开即用 |
| 热启动时间 | <500ms | 切换应用后快速恢复 |
| 流式响应延迟 | <100ms | 打字机效果流畅 |
| 动画帧率 | 60fps | Zoom Drawer 等动画流畅 |
| 内存占用 | <100MB | 避免被系统杀死 |
| 安装包大小 | <50MB | 降低下载门槛 |

### Security

| 要求 | 描述 |
|------|------|
| 本地存储加密 | 敏感数据（API Key、对话）加密存储 |
| 生物识别 | 支持 Face ID / 指纹解锁 |
| API Key 安全 | Key 不明文存储，不上传服务器 |
| 网络安全 | 所有 API 请求使用 HTTPS |
| 隐私模式 | 临时对话不写入存储 |

### Accessibility

| 要求 | 描述 |
|------|------|
| 字体缩放 | 支持系统字体大小设置 |
| 对比度 | 深色/浅色模式满足 WCAG AA |
| 屏幕阅读器 | 关键元素支持语义化标签 |
| 触摸目标 | 按钮最小 44x44pt |

---

## Technical Constraints

### 技术栈（已确定）

| 层级 | 技术 | 版本 |
|------|------|------|
| 框架 | Flutter | 3.38+ |
| 语言 | Dart | 3.10.1+ |
| UI 组件 | shadcn_flutter | ^0.0.47 |
| 状态管理 | Riverpod | ^2.5.1 |
| 数据模型 | Freezed | ^2.5.7 |
| AI SDK | google_generative_ai | ^0.4.6 |
| Markdown | flutter_markdown | ^0.7.4+1 |

### 依赖约束

- 不引入 Electron 或 Web 容器方案
- 优先使用 Flutter 原生能力
- 第三方依赖需评估维护状态

---

## Out of Scope (MVP)

以下功能明确不在 MVP 范围内：

- ❌ 用户注册/登录系统
- ❌ 云端数据同步
- ❌ 本地模型运行
- ❌ MCP 协议支持
- ❌ 插件系统
- ❌ 团队协作功能
- ❌ 企业版功能

---

## Risks & Mitigations

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| API 成本失控 | 中 | 高 | 用户自备 Key，不提供代理 |
| 大厂推出官方移动端 | 中 | 高 | 差异化定位（隐私+性能） |
| Flutter 生态问题 | 低 | 中 | 选择成熟稳定的依赖 |
| 多模型 API 兼容性 | 中 | 中 | 抽象统一接口层 |

---

## Appendix

### 竞品参考

- Cherry Studio: 功能全面的开源桌面客户端
- Monica: 浏览器集成的 AI 助手
- ChatBox: 跨平台开源客户端
- TypingMind: 高级 Web 客户端

### 相关文档

- [头脑风暴报告](./bmm-brainstorming-session-2024-11-28.md)
- [综合研究报告](./research-comprehensive-2024-11-28.md)
- [项目文档索引](./index.md)

---

_This PRD captures the essence of Cometix - 移动端最佳的隐私优先 AI 助手_

_Created through collaborative discovery between m1397 and AI facilitator._
